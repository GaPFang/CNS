from public import Admin_Pub_Key, admin_a, admin_w
from pwn import *

r = remote('cns.csie.org', 23462)

def long_to_bytes(n):
    return n.to_bytes((n.bit_length() + 7) // 8, 'big')

def main():
    r.sendlineafter('Who are talking to me?', 'Admin')
    r.sendlineafter('a = ', str(admin_a))
    r.sendlineafter('w = ', str(admin_w))
    r.recvuntil('c1 = ')
    c1 = int(r.recvline().strip().decode())
    r.recvuntil('c2 = ')
    c2 = int(r.recvline().strip().decode())
    r.close()
    print(f'c1 = {c1}')
    print(f'c2 = {c2}')

    c1 = 52863313176854130831661918519883541085367150731874784002099441292987836200963749316833188423234958164090223212376722996256348731579921982645515204011319275729590158320877849637675633350564574050580552797645451051238347456819009367011805917706497674152017508875547013410284328584630161543291930527352870003732
    c2 = 447311332524499992562427129617255881034006157012440242881950365835682336475839816155817562621827603585027474001829614367974475986264122547148472252886424043311269148975540856280215547720980335362438669886352595026590537602796281428645017391190335444935240270067282633110684297017963091231914343452890549792016
    # sage: discrete_log(c1, Mod(g, p))
    x = 307498352762761388364299862482025143550966804685622460281220330231103539478343143171848183498448175186822621103673049573339530385248652114956315082697711061224164069361054342969871966293730367197319411930303220590109938492417247483832099609366932203175336419815375196957045711168633441156415954834855925814561
    m = c2 * pow(pow(Admin_Pub_Key['y'], x, Admin_Pub_Key['p']), -1, Admin_Pub_Key['p']) % Admin_Pub_Key['p']
    print(long_to_bytes(m).decode())

if __name__ == '__main__':
    main()